{% extends 'app_general/base.html' %}

{% block content %}
<h1>รายละเอียดคำสั่งซื้อ</h1>

<div style="border: 1px solid #000; padding: 20px; margin-bottom: 20px;">
    <h2>ข้อมูลคำสั่งซื้อ</h2>
    <p><strong>หมายเลขคำสั่งซื้อ:</strong> {{ order.id }}</p>
    <p><strong>สถานะคำสั่งซื้อ:</strong> {{ order.get_order_status_display }}</p>
    <p><strong>วันที่สั่งซื้อ:</strong> {{ order.order_date|date:"d/m/Y H:i" }}</p>
</div>

<div style="border: 1px solid #000; padding: 20px; margin-bottom: 20px;">
    <h2>รายการสินค้า</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="border: 1px solid #000; padding: 8px;">สินค้า</th>
                <th style="border: 1px solid #000; padding: 8px;">จำนวน</th>
                <th style="border: 1px solid #000; padding: 8px;">ราคา</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order_items %}
            <tr>
                <td style="border: 1px solid #000; padding: 8px;">{{ item.product.name }}</td>
                <td style="border: 1px solid #000; padding: 8px; text-align: center;">{{ item.quantity }}</td>
                <td style="border: 1px solid #000; padding: 8px; text-align: right;">{{ item.product.price }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <p style="text-align: right;"><strong>ราคารวมสินค้า:</strong> {{ total_price }}</p>
    <p style="text-align: right;"><strong>ค่าจัดส่ง:</strong> {{ shipping_fee }}</p>
    <p style="text-align: right; font-size: 1.2em;"><strong>ราคารวมทั้งหมด:</strong> {{ total_price_with_shipping }}</p>
</div>

{% if payment_uploads %}
<div style="border: 1px solid #000; padding: 20px; margin-bottom: 20px;">
    <h2>รายละเอียดการชำระเงิน</h2>
    {% for payment in payment_uploads %}
        <p><strong>ชื่อผู้ชำระ:</strong> {{ payment.name }}</p>
        <p><strong>จำนวนเงิน:</strong> {{ payment.amount }}</p>
        <p><strong>เบอร์โทรศัพท์:</strong> {{ payment.phone }}</p>
        <p><strong>เวลาที่โอน:</strong> {{ payment.transfer_time|date:"d/m/Y H:i" }}</p>
        {% if payment.payment_slip %}
        <p><strong>หลักฐานการโอน:</strong></p>
        <img src="{{ payment.payment_slip.url }}" alt="Payment Slip" style="width: 200px;">
        {% endif %}
    {% endfor %}
</div>
{% else %}
<p>ไม่มีรายละเอียดการชำระเงิน</p>
{% endif %}

{% if order.delivery_method == 'delivery' %}
<div style="border: 1px solid #000; padding: 20px; margin-bottom: 20px;">
    <h2>ที่อยู่ในการจัดส่ง</h2>
    <p><strong>ถนน:</strong> {{ address.street }}</p>
    <p><strong>เขต/อำเภอ:</strong> {{ address.district }}</p>
    <p><strong>จังหวัด:</strong> {{ address.city }}</p>
    <p><strong>รหัสไปรษณีย์:</strong> {{ address.postal_code }}</p>
</div>
{% endif %}


{% if user_role == 'admin' %}
<div style="border: 1px solid #000; padding: 20px; margin-bottom: 20px;">
    <h2>อัปเดตสถานะคำสั่งซื้อและรายละเอียดการจัดส่ง</h2>
    <form method="post">
        {% csrf_token %}
        {{ order_form.as_p }}
        {{ admin_order_form.as_p }}
        <button type="submit">ยืนยันออร์เดอร์</button>
    </form>
</div>
{% endif %}

{% endblock %}
